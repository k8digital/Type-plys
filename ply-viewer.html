<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>PLY Particle Viewer</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #000;
        width: 100%;
        height: 100%;
      }
      canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="c"></canvas>

    <!-- Three.js + helpers via CDN -->
    <script src="https://unpkg.com/three@0.167.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.167.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.167.0/examples/js/loaders/PLYLoader.js"></script>

    <script>
      // STEP 1: use Lucy (known good) to prove the viewer works.
      const PLY_URL = "https://threejs.org/examples/models/ply/Lucy100k.ply";
      const POINT_SIZE = 0.01;

      const canvas = document.getElementById("c");
      const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio || 1);

      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x000000);

      const camera = new THREE.PerspectiveCamera(45, 1, 0.01, 1000);
      camera.position.set(0, 0, 3);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;
      controls.enablePan = false;

      function onResize() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        renderer.setSize(width, height, false);
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
      }
      window.addEventListener("resize", onResize);
      onResize();

      let points = null;

      function addPointsFromGeometry(geometry) {
        // Normalize size so giant models still fit the view
        geometry.computeBoundingSphere();
        const bs = geometry.boundingSphere;
        const radius = bs && bs.radius ? bs.radius : 1;
        const scale = 1 / radius;
        geometry.scale(scale, scale, scale);
        geometry.center();

        const material = new THREE.PointsMaterial({
          color: 0xffffff,
          size: POINT_SIZE,
          sizeAttenuation: true
        });

        points = new THREE.Points(geometry, material);
        scene.add(points);
      }

      // Fallback sphere so we never see pure black if loading fails.
      function addFallbackSphere() {
        const sphereGeometry = new THREE.SphereGeometry(1, 128, 128);
        addPointsFromGeometry(sphereGeometry);
      }

      const loader = new THREE.PLYLoader();
      loader.load(
        PLY_URL,
        function (geometry) {
          addPointsFromGeometry(geometry);
        },
        undefined,
        function (error) {
          console.error("Error loading PLY:", error);
          addFallbackSphere();
        }
      );

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene, camera);
      }
      animate();
    </script>
  </body>
</html>
